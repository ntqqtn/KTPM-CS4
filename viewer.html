<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viewer</title>
</head>
<body>
    <h1>Your key value is:</h1>
    <p id="value">loading...</p>
    <script>
        const locationPath = window.location.pathname.split("/");
        const key = locationPath[locationPath.length - 1];
        async function fetchValue() {
            try {
                const now = new Date();
                const datetime = now.toLocaleString('vi-VN');

                //add data to db
                const response = await fetch('http://localhost:8080/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ key: datetime, value: datetime })
                });

                //get all data in db
                const getData = await fetch('http://localhost:8080/getAll');
                console.log("getData:", getData);

                //get data with id
                const testGetId = await fetch('http://localhost:8080/get/undefined');
                const valueTestGetId = await testGetId.json();
                console.log("testGetId", valueTestGetId);

                //test api viewer with id
                const testViewId = await fetch('http://localhost:8080/viewer/1');

                if (getData.ok) {
                    const data = await getData.json();
                    // Biến data là mảng, hiển thị gộp giá trị chẳng hạn:

                    const display = data.map(item => `Key: ${item.keyID}, Value: ${item.value}`).join('\n');

                    console.log("data tu viewALl", data);
                    // const display = data.map(item => `Key: ${item.key}, Value: ${item.value}`).join('\n');
                    document.getElementById('value').innerText = display;
            } else {
                console.error('Failed to fetch value');
            }
            } catch (error) {
            console.error('Error:', error);
            }
        }

        fetchValue();
        // setInterval(fetchValue, 2000);
    </script>
</body>
</html>